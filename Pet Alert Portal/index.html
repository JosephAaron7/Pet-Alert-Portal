<html><head><base href="/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pet Alert Portal</title>
<style>
/* Reset and base styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', sans-serif;
    line-height: 1.6;
    background: #f8f9fa;
}

/* Navigation */
.navbar {
    background: #2c3e50;
    padding: 1rem;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    position: fixed;
    width: 100%;
    top: 0;
    z-index: 1000;
}

.nav-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
}

.nav-brand {
    color: white;
    text-decoration: none;
    font-size: 1.5rem;
    font-weight: bold;
}

.nav-links {
    display: flex;
    gap: 1.5rem;
}

.nav-link {
    color: white;
    text-decoration: none;
    transition: color 0.3s;
}

.nav-link:hover {
    color: #3498db;
}

/* Main Content */
.main-container {
    max-width: 1200px;
    margin: 60px auto 0;
    padding: 1rem;
}

.hero-section {
    text-align: center;
    padding: 2rem 0;
}

.logo {
    width: 150px;
    height: 150px;
    margin-bottom: 1rem;
}

/* Action Buttons */
.action-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.action-card {
    background: white;
    border-radius: 10px;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.3s;
}

.action-card:hover {
    transform: translateY(-5px);
}

.action-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    color: #3498db;
}

/* Forms */
.form-container {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    max-width: 600px;
    margin: 2rem auto;
    display: none;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: bold;
}

.form-input,
.form-select,
.form-textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1rem;
}

.form-textarea {
    min-height: 150px;
    resize: vertical;
}

/* Buttons */
.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
    transition: background-color 0.3s;
}

.btn-primary {
    background: #3498db;
    color: white;
}

.btn-primary:hover {
    background: #2980b9;
}

.btn-secondary {
    background: #95a5a6;
    color: white;
}

.btn-secondary:hover {
    background: #7f8c8d;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    max-width: 500px;
    margin: 2rem auto;
    position: relative;
}

.close-modal {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 1.5rem;
    cursor: pointer;
}

/* Responsive Design */
@media (max-width: 768px) {
    .nav-links {
        display: none;
    }
    
    .action-buttons {
        grid-template-columns: 1fr;
    }
}

/* Authentication Forms */
.auth-container {
    max-width: 400px;
    margin: 2rem auto;
    background: white;
    padding: 2rem;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    display: none;
}

.auth-toggle {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.auth-toggle button {
    background: none;
    border: none;
    color: #3498db;
    cursor: pointer;
    padding: 5px 10px;
    transition: color 0.3s;
}

.auth-toggle button:hover {
    color: #2980b9;
    text-decoration: underline;
}

/* Dashboard styles */
.dashboard {
    background: #ffffff;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-top: 2rem;
    padding: 2rem;
}

.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f0f0f0;
}

.dashboard-welcome {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.dashboard-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #3498db;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
}

.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 10px;
    text-align: center;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #3498db;
    margin-bottom: 0.5rem;
}

.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.quick-action-btn {
    background: #3498db;
    color: white;
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: transform 0.3s, background-color 0.3s;
}

.quick-action-btn:hover {
    transform: translateY(-2px);
    background: #2980b9;
}

.dashboard-section {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 10px;
    margin-bottom: 1.5rem;
}

.dashboard-section h3 {
    margin-bottom: 1rem;
    color: #2c3e50;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.dashboard-item {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.alert-preferences {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.preference-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.alert-status {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 15px;
    font-size: 0.875rem;
    margin-left: auto;
}

.status-active {
    background: #d4edda;
    color: #155724;
}

.status-inactive {
    background: #f8d7da;
    color: #721c24;
}

/* Success/Error Messages */
.message {
    padding: 1rem;
    border-radius: 5px;
    margin-bottom: 1rem;
    display: none;
}

.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

/* Animal Type Selection */
.animal-type-selector {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.type-option {
    flex: 1;
    padding: 1rem;
    border: 2px solid #ddd;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s;
}

.type-option:hover {
    border-color: #3498db;
    background: #f8f9fa;
}

.type-option.selected {
    border-color: #3498db;
    background: #ebf5fb;
}

/* Social and Donation Styles */
.social-donation-container {
    margin-top: 3rem;
    padding: 2rem;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.social-links {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.social-btn {
    color: #3498db;
    transition: color 0.3s, transform 0.3s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
    border-radius: 50%;
    background: rgba(52, 152, 219, 0.1);
}

.social-btn:hover {
    color: #2980b9;
    transform: scale(1.1);
    background: rgba(52, 152, 219, 0.2);
}

.share-btn {
    margin-left: 1rem;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    border-radius: 20px;
    background: #3498db;
    color: white;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
}

.share-btn:hover {
    background: #2980b9;
}

.donation-section {
    text-align: center;
}

.qr-code {
    width: 200px;
    height: 200px;
    margin: 1rem auto;
    display: block;
}

.donate-btn {
    margin-top: 1rem;
}

/* About Section Styles */
.about-section {
    max-width: 1200px;
    margin: 60px auto 0;
    padding: 2rem;
}

.about-content {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin: 1.5rem 0;
}

.mission-statement,
.statistics {
    grid-column: 1 / -1;
}

.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.stat-card {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 10px;
    text-align: center;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #3498db;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #666;
}

@media (max-width: 768px) {
    .about-content {
        grid-template-columns: 1fr;
    }
}
</style>

<!-- Navigation -->
<nav class="navbar">
    <div class="nav-container">
        <a href="/" class="nav-brand">Pet Alert Portal</a>
        <div class="nav-links">
            <button type="button" onclick="showAuthForms()" class="nav-link">Login/Register</button>
            <a href="javascript:void(0)" onclick="showDashboard()" class="nav-link user-dashboard" style="display: none;">Dashboard</a>
            <a href="javascript:void(0)" onclick="logout()" class="nav-link logout-link" style="display: none;">Logout</a>
            <a href="javascript:void(0)" onclick="showAboutPage()" class="nav-link" id="aboutLink">About Us</a>
        </div>
    </div>
</nav>

<!-- Main Content -->
<div class="main-container">
    <div class="hero-section">
        <svg class="logo" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="#3498db"/>
            <path d="M35,40 Q50,20 65,40" stroke="white" fill="none" stroke-width="3"/>
            <circle cx="35" cy="45" r="8" fill="white"/>
            <circle cx="65" cy="45" r="8" fill="white"/>
            <path d="M40,65 Q50,75 60,65" stroke="white" fill="none" stroke-width="3"/>
        </svg>
        <h1>Pet Alert Portal</h1>
        <p>Together we can make a difference in animal welfare</p>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <div class="action-card" onclick="showReportForm()">
            <div class="action-icon">🚨</div>
            <h3>Report</h3>
            <p>Report a lost, found, or injured animal</p>
        </div>
        <div class="action-card" onclick="showVolunteerForm()">
            <div class="action-icon">🤝</div>
            <h3>Volunteer</h3>
            <p>Join our network of animal welfare volunteers</p>
        </div>
        <div class="action-card" onclick="showAlertForm()">
            <div class="action-icon">🔔</div>
            <h3>Subscribe to Alerts</h3>
            <p>Get notified about animals in your area</p>
        </div>
    </div>

    <!-- Authentication Forms -->
    <div class="auth-container" id="authForms">
        <div id="loginForm">
            <h2>Login</h2>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="loginEmail" required>
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="loginPassword" required>
            </div>
            <button class="btn btn-primary" onclick="login()">Login</button>
            <div class="auth-toggle">
                <button onclick="toggleAuthForm('register')">Need an account? Register</button>
                <button onclick="showForgotPassword()" style="margin-left: 10px;">Forgot Password?</button>
            </div>
        </div>

        <div id="registerForm" style="display: none;">
            <h2>Register</h2>
            <div class="form-group">
                <label class="form-label">Name</label>
                <input type="text" class="form-input" id="registerName" required>
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="registerEmail" required>
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="registerPassword" required>
            </div>
            <button class="btn btn-primary" onclick="register()">Register</button>
            <div class="auth-toggle">
                <button onclick="toggleAuthForm('login')">Already have an account? Login</button>
            </div>
        </div>

        <div id="forgotPasswordForm" style="display: none;">
            <h2>Reset Password</h2>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="forgotPasswordEmail" required>
            </div>
            <button class="btn btn-primary" onclick="sendPasswordReset()">Reset Password</button>
            <div class="auth-toggle">
                <button onclick="toggleAuthForm('login')">Back to Login</button>
            </div>
        </div>
    </div>

    <!-- Report Form -->
    <div class="form-container" id="reportForm">
        <h2>Report an Animal</h2>
        
        <!-- Animal Type Selection -->
        <div class="animal-type-selector">
            <div class="type-option" onclick="selectAnimalType('stray')" id="strayOption">
                <div class="action-icon">🐱</div>
                <h4>Stray Animal</h4>
            </div>
            <div class="type-option" onclick="selectAnimalType('pet')" id="petOption">
                <div class="action-icon">🐶</div>
                <h4>Lost/Found Pet</h4>
            </div>
            <div class="type-option" onclick="selectAnimalType('injured')" id="injuredOption">
                <div class="action-icon">🚑</div>
                <h4>Injured Animal</h4>
            </div>
        </div>

        <div id="petSpecificFields" style="display: none;">
            <div class="form-group">
                <label class="form-label">Pet Name (if known)</label>
                <input type="text" class="form-input" id="petName" placeholder="Leave blank if unknown">
            </div>
            
            <div class="form-group">
                <label class="form-label">Collar/ID Tag</label>
                <select class="form-input" id="hasCollar">
                    <option value="">Select Option</option>
                    <option value="yes">Yes - Has Collar/ID Tag</option>
                    <option value="no">No Collar/ID Tag</option>
                    <option value="unknown">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Microchipped</label>
                <select class="form-input" id="hasMicrochip">
                    <option value="">Select Option</option>
                    <option value="yes">Yes - Confirmed Microchipped</option>
                    <option value="no">No Microchip</option>
                    <option value="unknown">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Vaccination Status</label>
                <select class="form-input" id="vaccinationStatus">
                    <option value="">Select Status</option>
                    <option value="fully_vaccinated">Fully Vaccinated</option>
                    <option value="partially_vaccinated">Partially Vaccinated</option>
                    <option value="not_vaccinated">Not Vaccinated</option>
                    <option value="unknown">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Distinguishing Features</label>
                <textarea class="form-textarea" id="petFeatures" placeholder="Any unique markings, colors, or characteristics that could help identify the pet"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Last Seen Date/Time</label>
                <input type="datetime-local" class="form-input" id="lastSeenDateTime">
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Animal Species</label>
            <select class="form-input" id="animalSpecies" required>
                <option value="">Select Species</option>
                <option value="dog">Dog</option>
                <option value="cat">Cat</option>
                <option value="bird">Bird</option>
                <option value="rabbit">Rabbit</option>
                <option value="other">Other</option>
            </select>
        </div>

        <div class="form-group" id="otherSpeciesGroup" style="display: none;">
            <label class="form-label">Specify Other Species</label>
            <input type="text" class="form-input" id="otherSpecies">
        </div>

        <div class="form-group">
            <label class="form-label">Temperament</label>
            <select class="form-input" id="animalTemperament" required>
                <option value="">Select Temperament</option>
                <option value="friendly">Friendly/Approachable</option>
                <option value="cautious">Cautious/Shy</option>
                <option value="aggressive">Aggressive/Defensive</option>
                <option value="unknown">Unknown</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">Urgency Level</label>
            <select class="form-input" id="urgencyLevel" required>
                <option value="">Select Urgency</option>
                <option value="critical">Critical - Immediate Attention Needed</option>
                <option value="urgent">Urgent - Needs Help Soon</option>
                <option value="moderate">Moderate - Needs Attention</option>
                <option value="low">Low - Monitor Situation</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">Health Status</label>
            <select class="form-input" id="healthStatus" required>
                <option value="">Select Health Status</option>
                <option value="healthy">Appears Healthy</option>
                <option value="minor">Minor Injuries/Issues</option>
                <option value="serious">Serious Health Issues</option>
                <option value="critical">Critical Condition</option>
                <option value="unknown">Unknown</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" id="reportLocation" required>
        </div>
        <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="reportDescription" required></textarea>
        </div>
        <div class="form-group">
            <label class="form-label">Contact Information</label>
            <input type="text" class="form-input" id="reportContact" required>
        </div>
        <div class="form-group">
            <label class="form-label">Upload Photos</label>
            <input type="file" class="form-input" id="reportPhotos" accept="image/*" multiple>
        </div>
        <button class="btn btn-primary" onclick="submitReport()">Submit Report</button>
        <button class="btn btn-secondary" onclick="hideForm('reportForm')">Cancel</button>
    </div>

    <!-- Volunteer Form -->
    <div class="form-container" id="volunteerForm">
        <h2>Volunteer Registration</h2>
        <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" class="form-input" id="volunteerName" required>
        </div>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="volunteerEmail" required>
        </div>
        <div class="form-group">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-input" id="volunteerPhone" required>
        </div>
        <div class="form-group">
            <label class="form-label">Available Hours</label>
            <input type="text" class="form-input" id="volunteerHours" required>
        </div>
        <div class="form-group">
            <label class="form-label">Experience</label>
            <textarea class="form-textarea" id="volunteerExperience" required></textarea>
        </div>
        <button class="btn btn-primary" onclick="submitVolunteer()">Register as Volunteer</button>
        <button class="btn btn-secondary" onclick="hideForm('volunteerForm')">Cancel</button>
    </div>

    <!-- Alert Subscription Form -->
    <div class="form-container" id="alertForm">
        <h2>Subscribe to Alerts</h2>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="alertEmail" required>
        </div>
        <div class="form-group">
            <label class="form-label">Phone Number (Optional)</label>
            <input type="tel" class="form-input" id="alertPhone" placeholder="For SMS alerts">
        </div>
        <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" id="alertLocation" required>
        </div>
        <div class="form-group">
            <label class="form-label">Alert Method</label>
            <div class="alert-preferences">
                <input type="checkbox" id="emailAlerts" checked> Email Alerts
                <input type="checkbox" id="smsAlerts"> SMS Alerts
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">Alert Preferences</label>
            <div class="alert-preferences">
                <input type="checkbox" id="lostPets"> Lost Pets
                <input type="checkbox" id="foundPets"> Found Pets
                <input type="checkbox" id="injuredAnimals"> Injured Animals
                <input type="checkbox" id="volunteerOpportunities"> Volunteer Opportunities
            </div>
        </div>
        <button class="btn btn-primary" onclick="submitAlertSubscription()">Subscribe</button>
        <button class="btn btn-secondary" onclick="hideForm('alertForm')">Cancel</button>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="userDashboard" style="display: none;">
        <div class="dashboard-header">
            <h2>Your Dashboard</h2>
            <button class="btn btn-secondary" onclick="logout()">Logout</button>
        </div>
        <div class="dashboard-content">
            <h3>Your Alert Preferences</h3>
            <div class="alert-preferences">
                <!-- Will be populated dynamically -->
            </div>
            <h3>Your Reports</h3>
            <div id="userReports">
                <!-- Will be populated dynamically -->
            </div>
            <h3>Your Volunteer Activities</h3>
            <div id="userVolunteerActivities">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div class="message success" id="successMessage"></div>
    <div class="message error" id="errorMessage"></div>

    <!-- Social and Donation Section -->
    <div class="social-donation-container">
        <div class="social-links">
            <a href="javascript:void(0)" onclick="shareSocial('facebook')" class="social-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm3 8h-1.35c-.538 0-.65.221-.65.778V10h2l-.209 2H13v7h-3v-7H8v-2h2V7.692C10 5.923 10.931 5 13.029 5H15v3z"/>
                </svg>
            </a>
            <a href="javascript:void(0)" onclick="shareSocial('twitter')" class="social-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/>
                </svg>
            </a>
            <a href="javascript:void(0)" onclick="copyToClipboard()" class="social-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
            </a>
        </div>
        <div style="margin-top: 20px; text-align: center;">
            <input type="text" value="${window.location.href}" 
                   readonly style="width: 100%; padding: 8px; margin-bottom: 10px;">
            <button class="btn btn-primary" onclick="copyToClipboard()">Copy Link</button>
        </div>
    </div>
    <div class="donation-section">
        <h3>Support Our Mission</h3>
        <img src="/PAYPAL QR CODE.png" alt="PayPal QR Code for donations" class="qr-code">
        <a href="https://paypal.me/petalertportal" target="_blank" class="btn btn-primary donate-btn">
            Donate Now
        </a>
    </div>
</div>

<div id="aboutSection" class="about-section" style="display:none;">
    <div class="dashboard-section">
        <div class="dashboard-header">
            <h2>About Pet Alert Portal</h2>
            <button class="btn btn-secondary" onclick="hideAboutPage()">
                Return to Home
            </button>
        </div>
        
        <div class="about-content">
            <div class="mission-statement dashboard-item">
                <h3>Our Mission</h3>
                <p>Pet Alert Portal is dedicated to creating a safer community for pets and their owners. We provide a centralized platform for reporting and tracking lost, found, and injured animals, while connecting concerned citizens with local animal welfare resources.</p>
                <p>Through our network of volunteers and partner organizations, we aim to ensure that every animal receives the care and attention they deserve, and every lost pet finds their way back home.</p>
            </div>
            
            <div class="about-features dashboard-item">
                <h3>What We Offer</h3>
                <ul>
                    <li>24/7 Lost & Found Pet Reporting System</li>
                    <li>Real-time Emergency Alerts for Animal Welfare</li>
                    <li>Volunteer Network Coordination</li>
                    <li>Community Support & Resources</li>
                    <li>Direct Connection with Local Animal Services</li>
                    <li>Pet Safety Education & Resources</li>
                </ul>
            </div>
            
            <div class="join-community dashboard-item">
                <h3>Get Involved</h3>
                <p>Your participation makes a difference! Join our growing community of animal advocates and help create a safer environment for all pets.</p>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="handleAboutPageAction('report')">
                        Report Animal
                    </button>
                    <button class="quick-action-btn" onclick="handleAboutPageAction('volunteer')">
                        Volunteer
                    </button>
                    <button class="quick-action-btn" onclick="handleAboutPageAction('alerts')">
                        Get Alerts
                    </button>
                </div>
            </div>
            
            <div class="statistics dashboard-item">
                <h3>Our Impact</h3>
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-number">1,000+</div>
                        <div class="stat-label">Pets Helped</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">500+</div>
                        <div class="stat-label">Active Volunteers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">Partner Organizations</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Global variable for current user
let currentUser = null;

// Database setup
async function setupDatabase() {
    try {
        // Create users table with additional fields
        await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY,
                name TEXT NOT NULL,
                email TEXT UNIQUE NOT NULL,
                password TEXT NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                last_login TIMESTAMP,
                last_active TIMESTAMP,
                status TEXT DEFAULT 'active',
                preferences TEXT DEFAULT '{}',
                profile_data TEXT,
                user_settings TEXT,
                account_type TEXT DEFAULT 'standard',
                verification_status TEXT DEFAULT 'pending',
                last_password_change TIMESTAMP,
                login_attempts INTEGER DEFAULT 0,
                UNIQUE(email)
            )`
        }));

        // Create an activity log table to track user actions
        await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `CREATE TABLE IF NOT EXISTS user_activity_log (
                id INTEGER PRIMARY KEY,
                user_id INTEGER NOT NULL,
                activity_type TEXT NOT NULL,
                activity_data TEXT,
                ip_address TEXT,
                user_agent TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY(user_id) REFERENCES users(id)
            )`
        }));

        // Create user preferences table for storing alert and notification settings
        await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `CREATE TABLE IF NOT EXISTS user_preferences (
                id INTEGER PRIMARY KEY,
                user_id INTEGER NOT NULL,
                preference_key TEXT NOT NULL,
                preference_value TEXT,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY(user_id) REFERENCES users(id),
                UNIQUE(user_id, preference_key)
            )`
        }));

        console.log('Database setup completed successfully');
    } catch (error) {
        console.error('Database setup error:', error);
        throw error;
    }
}

// Function to clear user-specific data
function clearUserData() {
    // Clear all user-specific data from the UI
    const dashboardContent = document.querySelector('.dashboard-content');
    if (dashboardContent) {
        // Clear alert preferences
        const alertPreferences = dashboardContent.querySelector('.alert-preferences');
        if (alertPreferences) {
            alertPreferences.innerHTML = '';
        }

        // Clear user reports
        const userReports = document.getElementById('userReports');
        if (userReports) {
            userReports.innerHTML = '';
        }

        // Clear volunteer activities
        const userVolunteerActivities = document.getElementById('userVolunteerActivities');
        if (userVolunteerActivities) {
            userVolunteerActivities.innerHTML = '';
        }
    }

    // Reset any user-specific form fields
    const forms = document.querySelectorAll('.form-container');
    forms.forEach(form => {
        const inputs = form.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            input.value = '';
        });
    });

    // Reset dashboard header
    const dashboardHeader = document.querySelector('.dashboard-header');
    if (dashboardHeader) {
        dashboardHeader.innerHTML = `
            <h2>Dashboard</h2>
            <button class="btn btn-secondary" onclick="logout()" style="display: none;">Logout</button>
        `;
    }

    // Clear any stored user data from localStorage
    localStorage.removeItem('userSession');
    localStorage.removeItem('userPreferences');
    localStorage.removeItem('userReports');
    localStorage.removeItem('userActivities');

    // Reset global user state
    currentUser = null;
}

// Load user alert preferences
function loadUserAlertPreferences() {
    if (!currentUser) return;
    
    try {
        const alertPreferences = document.querySelector('.alert-preferences');
        if (alertPreferences) {
            alertPreferences.innerHTML = `
                <div class="dashboard-item">
                    <h4>Current Alert Settings</h4>
                    <div class="preference-item">
                        <span>Email Alerts</span>
                        <span class="alert-status status-active">Active</span>
                    </div>
                    <div class="preference-item">
                        <span>SMS Alerts</span>
                        <span class="alert-status status-inactive">Inactive</span>
                    </div>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading alert preferences:', error);
    }
}

// Load user reports
function loadUserReports() {
    if (!currentUser) return;
    
    try {
        const userReports = document.getElementById('userReports');
        if (userReports) {
            userReports.innerHTML = `
                <div class="dashboard-item">
                    <p>No reports submitted yet.</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading user reports:', error);
    }
}

// Load user volunteer activities
function loadUserVolunteerActivities() {
    if (!currentUser) return;
    
    try {
        const userVolunteerActivities = document.getElementById('userVolunteerActivities');
        if (userVolunteerActivities) {
            userVolunteerActivities.innerHTML = `
                <div class="dashboard-item">
                    <p>No volunteer activities logged yet.</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading volunteer activities:', error);
    }
}

// Enhanced register function with better validation and error handling
async function register() {
    try {
        const name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value.trim();
        const password = document.getElementById('registerPassword').value;

        // Enhanced validation
        if (!name || name.length < 2) {
            throw new Error('Name must be at least 2 characters long');
        }

        if (!email || !email.match(/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/)) {
            throw new Error('Please enter a valid email address');
        }

        if (!password || password.length < 8) {
            throw new Error('Password must be at least 8 characters long');
        }

        // Check for existing user
        const checkEmail = await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `SELECT id FROM users WHERE email = '${email}'`
        }));
        const existingUser = await checkEmail.json();

        if (existingUser.length > 0) {
            throw new Error('Email already registered');
        }

        const hashedPassword = await hashPassword(password);
        const defaultPreferences = JSON.stringify({
            emailNotifications: true,
            smsNotifications: false,
            alertPreferences: {
                lostPets: true,
                foundPets: true,
                injuredAnimals: true,
                volunteerOpportunities: true
            }
        });

        // Insert new user with additional data
        const result = await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `INSERT INTO users (
                name, 
                email, 
                password,
                created_at,
                last_login,
                status,
                preferences,
                profile_data,
                verification_status
            ) VALUES (
                '${name}',
                '${email}',
                '${hashedPassword}',
                CURRENT_TIMESTAMP,
                CURRENT_TIMESTAMP,
                'active',
                '${defaultPreferences}',
                '{}',
                'pending'
            ) RETURNING id, name, email`
        }));

        const newUser = await result.json();

        if (newUser.length > 0) {
            const sessionToken = await createSession(newUser[0].id);
            
            // Store session info
            localStorage.setItem('userSession', JSON.stringify({
                token: sessionToken,
                userId: newUser[0].id,
                email: newUser[0].email,
                name: newUser[0].name,
                created: new Date().toISOString()
            }));

            currentUser = newUser[0];
            
            // Log the registration
            await logUserActivity(newUser[0].id, 'user_registration', {
                registrationMethod: 'email',
                timestamp: new Date().toISOString()
            });
            
            showSuccess('Registration successful! Welcome to Pet Alert Portal!');
            updateUIForLoggedInUser();
            document.getElementById('authForms').style.display = 'none';
        } else {
            throw new Error('Registration failed');
        }

    } catch (error) {
        console.error('Registration error:', error);
        showError(error.message || 'Registration failed. Please try again.');
    }
}

// Function to validate session and restore user state
async function validateSession() {
    const session = localStorage.getItem('userSession');
    if (!session) return false;

    try {
        const sessionData = JSON.parse(session);
        const result = await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `SELECT u.*, s.session_token 
                  FROM users u 
                  JOIN user_sessions s ON u.id = s.user_id 
                  WHERE s.session_token = '${sessionData.token}'
                  AND s.expires_at > datetime('now')`
        }));
        const userData = await result.json();

        if (userData && userData.length > 0) {
            currentUser = userData[0];
            return true;
        }
    } catch (error) {
        console.error('Session validation error:', error);
    }

    localStorage.removeItem('userSession');
    return false;
}

// Update the initializePage function
async function initializePage() {
    try {
        // Setup database tables
        await setupDatabase();
        
        // Initialize currentUser as null using proper assignment
        currentUser = null; // Changed from window.currentUser = null
        
        // Check for existing session
        const session = localStorage.getItem('userSession');
        if (session) {
            const sessionData = JSON.parse(session);
            const validSession = await validateSession(sessionData.token);
            
            if (validSession) {
                currentUser = sessionData; // Changed from window.currentUser = sessionData
                updateUIForLoggedInUser();
            } else {
                updateUIForLoggedOutUser();
            }
        } else {
            updateUIForLoggedOutUser();
        }
        
        // Run diagnostic tests after initialization
        await runDiagnosticTests();
        
    } catch (error) {
        console.error('Error initializing page:', error);
        updateUIForLoggedOutUser();
    }
}

// Enhanced login function
async function login() {
    try {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        const hashedPassword = await hashPassword(password);

        const result = await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `SELECT * FROM users WHERE email = '${email}' AND password = '${hashedPassword}'`
        }));
        const users = await result.json();

        if (users.length === 1) {
            const user = users[0];
            const sessionToken = await createSession(user.id);
            const sessionData = {
                token: sessionToken,
                userId: user.id,
                email: user.email,
                name: user.name
            };
            
            localStorage.setItem('userSession', JSON.stringify(sessionData));
            currentUser = user; // Changed from window.currentUser = user
            
            showSuccess('Login successful!');
            updateUIForLoggedInUser();
            document.getElementById('authForms').style.display = 'none';
        } else {
            throw new Error('Invalid credentials');
        }
    } catch (error) {
        console.error('Login error:', error);
        showError('Login failed. Please check your credentials.');
    }
}

// Update the user activity logging function
async function logUserActivity(userId, activityType, activityData) {
    try {
        const serializedData = JSON.stringify(activityData);
        await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `INSERT INTO user_activity_log (
                user_id, 
                activity_type, 
                activity_data
            ) VALUES (
                ${userId},
                '${activityType}',
                '${serializedData}'
            )`
        }));
    } catch (error) {
        console.error('Error logging user activity:', error);
    }
}

// Initialize the page and check session
document.addEventListener('DOMContentLoaded', initializePage);

// Add password hashing function (in production, use a proper hashing library)
async function hashPassword(password) {
    // This is a simple hash for demonstration. In production, use bcrypt or similar
    let hash = 0;
    for (let i = 0; i < password.length; i++) {
        const char = password.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return hash.toString(36);
}

// Function to show success message
function showSuccess(message) {
    const successMessage = document.getElementById('successMessage');
    successMessage.textContent = message;
    successMessage.style.display = 'block';
    setTimeout(() => {
        successMessage.style.display = 'none';
    }, 3000);
}

// Function to show error message
function showError(message) {
    const errorMessage = document.getElementById('errorMessage');
    errorMessage.textContent = message;
    errorMessage.style.display = 'block';
    setTimeout(() => {
        errorMessage.style.display = 'none';
    }, 3000);
}

// Enhanced logout function
async function logout() {
    try {
        const session = localStorage.getItem('userSession');
        if (session) {
            const sessionData = JSON.parse(session);
            await fetch('/api/v1/sql/?' + new URLSearchParams({
                sql: `DELETE FROM user_sessions WHERE session_token = '${sessionData.token}'`
            }));
        }
        localStorage.removeItem('userSession');
        currentUser = null;
        updateUIForLoggedOutUser();
        showSuccess('Logged out successfully');
        document.getElementById('userDashboard').style.display = 'none';
    } catch (error) {
        console.error('Logout error:', error);
        showError('Error during logout. Please try again.');
    }
}

// Function to update UI for logged out users
function updateUIForLoggedOutUser() {
    // Hide user-specific elements
    const userDashboard = document.querySelector('.user-dashboard');
    if (userDashboard) {
        userDashboard.style.display = 'none';
    }

    const dashboardElement = document.getElementById('userDashboard');
    if (dashboardElement) {
        dashboardElement.style.display = 'none';
    }

    const logoutLink = document.querySelector('a[onclick="logout()"]');
    if (logoutLink) {
        logoutLink.style.display = 'none';
    }
    
    // Show login/register elements 
    const loginButton = document.querySelector('button[onclick="showAuthForms()"]');
    if (loginButton) {
        loginButton.style.display = 'block';
    }
    
    // Clear user data
    clearUserData();
}

// Function to update UI for logged in users
function updateUIForLoggedInUser() {
    // Show user-specific elements
    const userDashboard = document.querySelector('.user-dashboard');
    if (userDashboard) {
        userDashboard.style.display = 'block';
    }
    
    const dashboardElement = document.getElementById('userDashboard');
    if (dashboardElement) {
        dashboardElement.style.display = 'block';
    }
    
    const logoutLink = document.querySelector('a[onclick="logout()"]');
    if (logoutLink) {
        logoutLink.style.display = 'block';
    }
    
    // Hide login/register elements
    const loginButton = document.querySelector('button[onclick="showAuthForms()"]');
    if (loginButton) {
        loginButton.style.display = 'none';
    }
    
    const authForms = document.getElementById('authForms');
    if (authForms) {
        authForms.style.display = 'none';
    }
    
    // Update dashboard with user info if available
    if (currentUser) {
        const dashboardHeader = document.querySelector('.dashboard-header');
        if (dashboardHeader) {
            dashboardHeader.innerHTML = `
                <div class="dashboard-welcome">
                    <div class="dashboard-avatar">
                        ${currentUser.name ? currentUser.name.charAt(0).toUpperCase() : 'U'}
                    </div>
                    <div>
                        <h2>Welcome, ${currentUser.name || 'User'}!</h2>
                        <p>${currentUser.email}</p>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="logout()">Logout</button>
            `;
        }

        // Load user data
        loadUserAlertPreferences();
        loadUserReports();
        loadUserVolunteerActivities();
    }
}

// Function to show/hide authentication forms
function showAuthForms() {
    hideAllContent();
    document.getElementById('authForms').style.display = 'block';
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('forgotPasswordForm').style.display = 'none';
}

// Function to toggle between login and register forms
function toggleAuthForm(formType) {
    document.getElementById('loginForm').style.display = formType === 'login' ? 'block' : 'none';
    document.getElementById('registerForm').style.display = formType === 'register' ? 'block' : 'none';
    document.getElementById('forgotPasswordForm').style.display = 'none';
}

// Function to show forgot password form
function showForgotPassword() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('forgotPasswordForm').style.display = 'block';
}

// Function to create a user session
async function createSession(userId) {
    try {
        const sessionToken = Math.random().toString(36).substring(2) + Date.now().toString(36);
        const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours from now
        
        await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `CREATE TABLE IF NOT EXISTS user_sessions (
                id INTEGER PRIMARY KEY,
                user_id INTEGER NOT NULL,
                session_token TEXT NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                expires_at TIMESTAMP NOT NULL,
                FOREIGN KEY(user_id) REFERENCES users(id)
            )`
        }));

        await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: `INSERT INTO user_sessions (user_id, session_token, expires_at) 
                  VALUES (${userId}, '${sessionToken}', '${expiresAt.toISOString()}')`
        }));

        return sessionToken;
    } catch (error) {
        console.error('Error creating session:', error);
        throw error;
    }
}

// Functions to show/hide different forms
function showReportForm() {
    hideAllContent();
    document.getElementById('reportForm').style.display = 'block';
}

function showVolunteerForm() {
    hideAllContent();
    document.getElementById('volunteerForm').style.display = 'block';
}

function showAlertForm() {
    hideAllContent();
    document.getElementById('alertForm').style.display = 'block';
}

// Function to hide all content
function hideAllContent() {
    const mainContainers = [
        'userDashboard',
        'reportForm',
        'volunteerForm',
        'alertForm',
        'authForms',
        'aboutSection'
    ];
    
    mainContainers.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = 'none';
        }
    });
}

// About page functions
function handleAboutPageAction(action) {
    hideAboutPage();
    switch(action) {
        case 'report':
            showReportForm();
            break;
        case 'volunteer':
            showVolunteerForm();
            break;
        case 'alerts':
            showAlertForm();
            break;
    }
}

function showAboutPage() {
    // Get the elements
    const aboutSection = document.getElementById('aboutSection');
    const mainContainer = document.querySelector('.main-container');
    
    if (aboutSection && mainContainer) {
        // Hide everything in main container except the navbar
        const children = mainContainer.children;
        for (let i = 0; i < children.length; i++) {
            if (!children[i].classList.contains('navbar')) {
                children[i].style.display = 'none';
            }
        }
        
        // Show about section
        aboutSection.style.display = 'block';
    }
}

function hideAboutPage() {
    const aboutSection = document.getElementById('aboutSection');
    const mainContainer = document.querySelector('.main-container');
    
    if (aboutSection) {
        aboutSection.style.display = 'none';
    }
    
    // Show main content
    const heroSection = document.querySelector('.hero-section');
    const actionButtons = document.querySelector('.action-buttons');
    
    if (heroSection) heroSection.style.display = 'block';
    if (actionButtons) actionButtons.style.display = 'grid';
    
    // Show appropriate forms based on user login status
    if (currentUser) {
        document.querySelector('.user-dashboard').style.display = 'block';
        document.querySelector('.logout-link').style.display = 'block';
    }
}

// Social sharing functions
async function shareContent() {
    try {
        // Check if the Web Share API is supported and we have permission
        if (navigator.share && await checkSharePermission()) {
            await navigator.share({
                title: 'Pet Alert Portal',
                text: 'Help lost and injured animals find their way home!',
                url: window.location.href
            });
        } else {
            // Fallback sharing method
            showShareFallback();
        }
    } catch (error) {
        console.error('Sharing failed:', error);
        // If sharing fails, show the fallback
        showShareFallback();
    }
}

async function checkSharePermission() {
    try {
        // Check if we have permission to use the share API
        if (navigator.permissions && navigator.permissions.query) {
            const result = await navigator.permissions.query({ name: 'web-share' });
            return result.state === 'granted';
        }
        // If permissions API is not available, assume we can try sharing
        return true;
    } catch (error) {
        console.warn('Share permission check failed:', error);
        return false;
    }
}

function showShareFallback() {
    // Create a modal for fallback sharing options
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const modalContent = document.createElement('div');
    modalContent.className = 'modal-content';
    
    modalContent.innerHTML = `
        <span class="close-modal" onclick="this.parentElement.parentElement.remove()">&times;</span>
        <h3>Share Pet Alert Portal</h3>
        <div class="social-links" style="margin-top: 20px;">
            <a href="javascript:void(0)" onclick="shareSocial('facebook')" class="social-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm3 8h-1.35c-.538 0-.65.221-.65.778V10h2l-.209 2H13v7h-3v-7H8v-2h2V7.692C10 5.923 10.931 5 13.029 5H15v3z"/>
                </svg>
            </a>
            <a href="javascript:void(0)" onclick="shareSocial('twitter')" class="social-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M23.643 4.937c-.835.37-1.732.62-2.675.733.962-.576 1.7-1.49 2.048-2.578-.9.534-1.897.922-2.958 1.13-.85-.904-2.06-1.47-3.4-1.47-2.572 0-4.658 2.086-4.658 4.66 0 .364.042.718.12 1.06-3.873-.195-7.304-2.05-9.602-4.868-.4.69-.63 1.49-.63 2.342 0 1.616.823 3.043 2.072 3.878-.764-.025-1.482-.234-2.11-.583v.06c0 2.257 1.605 4.14 3.737 4.568-.392.106-.803.162-1.227.162-.3 0-.593-.028-.877-.082.593 1.85 2.313 3.198 4.352 3.234-1.595 1.25-3.604 1.995-5.786 1.995-.376 0-.747-.022-1.112-.065 2.062 1.323 4.51 2.093 7.14 2.093 8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602.91-.658 1.7-1.477 2.323-2.41z"/>
                </svg>
            </a>
            <a href="javascript:void(0)" onclick="copyToClipboard()" class="social-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
            </a>
        </div>
        <div style="margin-top: 20px; text-align: center;">
            <input type="text" value="${window.location.href}" 
                   readonly style="width: 100%; padding: 8px; margin-bottom: 10px;">
            <button class="btn btn-primary" onclick="copyToClipboard()">Copy Link</button>
        </div>
    `;
    
    modal.appendChild(modalContent);
    document.body.appendChild(modal);
}

// Add a copy to clipboard function
async function copyToClipboard() {
    try {
        await navigator.clipboard.writeText(window.location.href);
        showSuccess('Link copied to clipboard!');
    } catch (error) {
        console.error('Failed to copy:', error);
        // Fallback for older browsers
        const input = document.createElement('input');
        input.value = window.location.href;
        document.body.appendChild(input);
        input.select();
        document.execCommand('copy');
        document.body.removeChild(input);
        showSuccess('Link copied to clipboard!');
    }
}

// Update the shareSocial function to handle errors
function shareSocial(platform) {
    try {
        const url = encodeURIComponent(window.location.href);
        const text = encodeURIComponent('Check out Pet Alert Portal - helping lost and injured animals!');
        let shareUrl;
        
        switch(platform) {
            case 'facebook':
                shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                break;
            case 'twitter':
                shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
                break;
            case 'instagram':
                showError('Instagram sharing is only available through the Instagram app');
                return;
        }
        
        if (shareUrl) {
            // Open in a new window with proper size and centered position
            const width = 600;
            const height = 400;
            const left = (window.innerWidth - width) / 2;
            const top = (window.innerHeight - height) / 2;
            
            window.open(
                shareUrl,
                'share',
                `width=${width},height=${height},left=${left},top=${top},location=no,menubar=no`
            );
        }
    } catch (error) {
        console.error('Social sharing error:', error);
        showError('Unable to share at this time. Please try copying the link instead.');
    }
}

// Form submission functions
async function submitReport() {
    if (!currentUser) {
        showError('Please login to submit a report');
        showAuthForms();
        return;
    }
    
    try {
        // Add report submission logic here
        showSuccess('Report submitted successfully!');
        hideForm('reportForm');
    } catch (error) {
        showError('Error submitting report');
    }
}

async function submitVolunteer() {
    if (!currentUser) {
        showError('Please login to volunteer');
        showAuthForms();
        return;
    }
    
    try {
        // Add volunteer submission logic here
        showSuccess('Volunteer application submitted successfully!');
        hideForm('volunteerForm');
    } catch (error) {
        showError('Error submitting volunteer application');
    }
}

async function submitAlertSubscription() {
    if (!currentUser) {
        showError('Please login to subscribe to alerts');
        showAuthForms();
        return;
    }
    
    try {
        // Add alert subscription logic here
        showSuccess('Alert preferences saved successfully!');
        hideForm('alertForm');
    } catch (error) {
        showError('Error saving alert preferences');
    }
}

// Function to run diagnostic tests
async function runDiagnosticTests() {
    try {
        // Test database connection
        await fetch('/api/v1/sql/?' + new URLSearchParams({
            sql: 'SELECT 1'
        }));
        
        // Test session handling
        const testSession = await createSession(-1); // Test user ID
        if (!testSession) throw new Error('Session creation failed');
        
        console.log('Diagnostic tests completed successfully');
    } catch (error) {
        console.error('Diagnostic test failed:', error);
    }
}

// Function to select animal type
function selectAnimalType(type) {
    // Remove selected class from all options
    document.querySelectorAll('.type-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    // Add selected class to chosen option
    document.getElementById(`${type}Option`).classList.add('selected');
    
    // Show/hide pet-specific fields
    document.getElementById('petSpecificFields').style.display = 
        type === 'pet' ? 'block' : 'none';
}

// Function to send password reset
async function sendPasswordReset() {
    const email = document.getElementById('forgotPasswordEmail').value;
    try {
        // In a real application, you would send a password reset email
        showSuccess('Password reset instructions sent to your email');
        toggleAuthForm('login');
    } catch (error) {
        showError('Error sending password reset');
    }
}
</script>
</body></html>